# 个人博客系统文章列表页组件设计说明文档







> [!note]
>
> **注意**
>
> 文章列表页在第 22 讲的细节实现中引入了多个专用组件，分别是递归组件 `HierarchyList`、博文列表组件 `BlogList` 及其依赖的子组件 `BlogCard`、还有博文对应的分类列表组件 `BlogCategory`。本文档先对上述组件的用法作解释说明，后续若新增其他功能模块，则相应更新到本文档末尾。



## 1 递归组件 HierarchyList

主要用于渲染右边侧边栏的文章分类列表（后续也可用于渲染文章详情页的目录大纲列表）。

`props` 传参配置：

|  属性名  |   类型   | 默认值 | 是否必填 | 说明                                                         |
| :------: | :------: | :----: | :------: | :----------------------------------------------------------- |
|  `data`  | `Array`  |  `[]`  |    是    | 渲染列表所需的树形对象数组。节点元素必须包含 `id`、`label`，可以选择性包含 `count`、`children` 字段，分别表示当前节点的唯一标识（数字型）、节点主要渲染内容（字符型）、该节点的文章数（整数型，用于渲染附加内容），以及子列表。若存在多级树形嵌套结构，则必须包含 `children` 数组。 |
| `currId` | `Number` |  `0`   |    是    | 当前选中的节点 `id`，数字型，配合 `active` 样式类可高亮显示初始加载（或后期鼠标单击）选中的列表项。 |

事件列表：

| 事件名      | 回调参数                                 | 触发时机                                                     |
| :---------- | :--------------------------------------- | :----------------------------------------------------------- |
| `@selected` | `item`（选中当前列表项对应的 `JS` 对象） | 鼠标单击某列表项的文本内容时（若存在附加信息，则点击该信息依然有效）触发。 |



## 2 博文分类列表组件

即 `BlogCategory` 组件，主要依赖 `HierarchyList` 组件完成树形或普通列表的渲染。用于生成文章正文右侧的侧边栏部分。

该组件的数据源来自 `mixin` 混入方法 `getBlogCategories()`，对应的远程接口为 `GET /api/blogtype`。

数据源 `this.data` 的初始化在 `created` 钩子内完成。渲染列表所需的数据源 `this.categories` 必须通过【计算属性】转化为满足 `HierarchyList` 要求的对象数组后，方可正常渲染。

在计算 `this.categories` 数组的过程中，需要补充一个表示【全部】的列表项，分类 `ID` 用 `-1` 表示；其 `count` 值是 `this.data` 所有元素节点的 `count` 值的汇总。

组件核心数据流：

1. 通过远程加载数据的 `mixin` 模块获得列表数据源（`mixin` 混入模块要求组件内必须定义 `async getRemoteData()` 方法）；
2. 渲染完成后，分类列表通过鼠标单击切换选中的分类，并以编程的方式更新路由信息；
3. 正文区的博文列表通过 `watch` 钩子观察路由信息的变更，并同步刷新文章列表，得到当前分类下的博文分页列表。



## 3 博文列表组件

即正文区的博客文章列表页组件 `BlogList`，其渲染依赖两个子组件：`BlogCard` 和分页组件 `Pager`。`BlogCard` 表示文章列表中的某一项；`Pager` 用于变更路由信息中的分页参数，在每次触发页码单击事件后完成更新。

列表项的数据源来自远程接口调用（`GET /api/blog`），方法签名为 `async function getBlogs(page = 1, limit = 10, categoryId = -1)`。

与分类列表相似，文章列表所需的数据源也是通过【计算属性】转换后得到的（`this.blogs`）；分类组件必需的总页码参数 `this.total` 也是从 `this.data` 中获取。

组件核心逻辑：

1. 通过远程加载数据的 `mixin` 模块获得列表数据源（`mixin` 混入模块要求组件内必须定义 `async getRemoteData()` 方法）；
2. 渲染完文章列表和分页条后，单击某个页码标签，触发分页组件的 `pageChange` 事件；
3. 将 `pageChange` 事件中的新页码更新到路由信息中；
4. 设置 `watch` 钩子观察 `this.$route` 对象，用新参数重新请求远程数据源；
5. Bug 修复：刷新数据时，需要手动指定滚动条到页面顶部（`this.$refs.blogList.scrollTop = 0;`）。

> [!tip]
>
> **使用技巧**
>
> 由于组件内多次用到路由信息中的分类 `ID`、当前页码 `page`、页容量 `limit`，这里再次利用【计算属性】从路由中提取参数，方便后续统一调用。



## 4 博文列表元素项组件

即 `BlogCard` 组件，用于渲染博文列表中的某一列表项。

列表项的数据源来自远程接口调用（`GET /api/blog`），方法签名为 `async function getBlogs(page = 1, limit = 10, categoryId = -1)`。

`props` 传参配置：

| 属性名 |  类型   | 默认值 | 是否必填 | 说明                         |
| :----: | :-----: | :----: | :------: | :--------------------------- |
| `data` | `Array` |  `[]`  |    是    | 数组元素中的属性名详见示例。 |

`this.data` 元素项示例：

```js
{
  id: "文章id",
  title: "标题",
  description: "示例文章摘要示例文章摘要示例文章摘要示例文章摘要示例文章摘要",
  category: {
    id: 3,
    name: "分类3",
  },
  scanNumber: 10,
  commentNumber: 30,
  thumb: "缩略图地址",
  createDate: 1735689600000,  // 时间戳对应的毫秒数
}
```

其中，缩略图不是必选项，若不存在缩略图，该列表项应平铺多出的空白部分。